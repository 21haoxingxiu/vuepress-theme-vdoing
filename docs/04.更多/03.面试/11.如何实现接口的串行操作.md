---
title: 如何实现接口的串行操作
date: 2021-04-11 15:58:42
permalink: /pages/64c3c9/
categories:
  - 更多
  - 面试
tags:
  - 
---
### JS实现串行请求


#### 使用async await

```js
const SerialPromise = async (promiseArr) => {
  for(let i=0; i<promiseArr.length; i++) {
    currentPromise = (promiseArr[i] instanceOf Promise) ? promiseArr[i] : Promise.reslove(promise[i])
    var result = await currentPromise
  }
}
```

#### Promise实现

依照 promises 规范，一旦一个 promise 被创建，它就被执行了。如果then方法里返回的是一个promise对象，那么执行下一个then 的时候必定是在上一个then执行完之后执行。

关键点在于then的时候再创建

##### 打印结果

2,1,3,4,5

```js
var createPromise = function(time) {
    return (resolve, reject)=> {
      return new Promise((resolve, reject)=>{
          setTimeout(()=>{
              console.log('timein'+time)
              resolve();
          }, time*1000)
      })
    }
}

function serpromise(arr) {
    arr.reduce((pre, next, index, carr)=>{
        return pre.then(next)
    }, Promise.resolve())
}

var arr=[createPromise(2),createPromise(1),createPromise(3),createPromise(4),createPromise(5)];
// 相当于
// Promise.resolve().then(createPromise(2)).then(createPromise(1))......
serpromise(arr)
```



#### 使用for of实现

##### 打印结果

1,2,3,4,5

```js
var arr=[createPromise(2),createPromise(1),createPromise(3),createPromise(4),createPromise(5)];

(async function() {
   for await (fn of arr) {
    fn();
   }
})()

// 依次打印出 1 2 3 4 5 

```

### 迭代异步可迭代对象

你还可以迭代一个明确实现异步迭代协议的对象：

```js
var asyncIterable = {
  [Symbol.asyncIterator]() {
    return {
      i: 0,
      next() {
        if (this.i < 3) {
          return Promise.resolve({ value: this.i++, done: false });
        }

        return Promise.resolve({ done: true });
      }
    };
  }
};

(async function() {
   for await (num of asyncIterable) {
     console.log(num);
   }
})();

// 0
// 1
// 2
```

### 迭代异步生成器 

异步生成器已经实现了异步迭代器协议, 所以可以用 for await...of循环。

```js
async function* asyncGenerator() {
  var i = 0;
  while (i < 3) {
    yield i++;
  }
}

(async function() {
  for await (num of asyncGenerator()) {
    console.log(num);
  }
})();
// 0
// 1
// 2
```